{% extends 'base.html' %}
{% block title %}{{ user.username }}的个人主页{% endblock %}
{% block main %}
    <div id="main">
        {% include 'sidebar.html' %}
        <div id="content">
            <div class="panel">
                <div class="header">
                    <ul class="breadcrumb">
                        <li><a href="{{ url_for('.index') }}">主页</a><span class="divider">/</span></li>
                    </ul>
                </div>
                <div class="inner userinfo">
                    <div class="user_big_avatar">
                        <img src="{{ user.image }}" class="user_avatar"
                             title={{ user.username }}>
                    </div>
                    <a class="dark">{{ user.username }}</a>
                    <p class="col_fade">注册时间 <span class="created-time"
                                                   data-created_time="{{ user.created_time }}"></span>
                    </p>
                </div>
            </div>

            <div class="panel">
                <div class="header">
                    <span class="col_fade">最近创建的话题</span>
                </div>

                {% for t in created %}
                    {% set u =t.user() %}
                    <div class="cell">
                        <a class="user_avatar pull-left" href="/user/{{ t.user_id }}">
                            <img src="{{ u.image }}" title="{{ u.username }}"/>
                        </a>

                        <span class="reply_count pull-left">
                            <span class="count_of_replies" title="回复数">{{ t.replies() | count }}</span>
                            <span class="count_seperator">/</span>
                            <span class="count_of_visits" title='点击数'>{{ t.views }}</span>
                        </span>

                        {% set r = t.last_reply() %}
                        {% if r is not none %}
                            {% set replier = r.user() %}
                            <a class='last_time pull-right'
                               href="{{ url_for('topic.detail', id=t.id, _anchor=t.replies() | count) }}">
                                <img class="user_small_avatar" src="{{ replier.image }}">
                                <span class="last_active_time created-time"
                                      data-created_time="{{ r.created_time }}"></span>
                            </a>
                        {% else %}
                            <span class='last_time pull-right'>
                                  <span class="last_active_time created-time"
                                        data-created_time="{{ t.created_time }}"></span>
                            </span>
                        {% endif %}

                        <div class="topic_title_wrapper">
                            <a class="topic_title" href="{{ url_for('topic.detail', id=t.id) }}">
                                {{ t.title }}
                            </a>
                        </div>
                    </div>
                {% endfor %}
                {#            <div class="cell more">#}
                {#                <a class="dark" href="/user/justjavac/topics">查看更多»</a>#}
                {#            </div>#}

            </div>

            <div class="panel">
                <div class="header">
                    <span class="col_fade">最近参与的话题</span>
                </div>

                {% for t in replied %}
                    {% set u = t.user() %}
                    <div class="cell">
                        <a class="user_avatar pull-left" href="/user/{{ t.user_id }}">
                            <img src="{{ u.image }}" title="{{ u.username }}"/>
                        </a>

                        <span class="reply_count pull-left">
                            <span class="count_of_replies" title="回复数">
                              {{ t.replies() | count }}
                            </span>
                            <span class="count_seperator">/</span>
                            <span class="count_of_visits" title='点击数'>
                              {{ t.views }}
                            </span>
                        </span>

                        {% set r = t.last_reply() %}
                        {% if r is not none %}
                            {% set replier = r.user() %}
                            <a class='last_time pull-right'
                               href="{{ url_for('topic.detail', id=t.id, _anchor=t.replies() | count) }}">
                                <img class="user_small_avatar" src="{{ replier.image }}">
                                <span class="last_active_time created-time"
                                      data-created_time="{{ r.created_time }}"></span>
                            </a>
                        {% else %}
                            <span class='last_time pull-right'>
                                  <span class="last_active_time created-time"
                                        data-created_time="{{ t.created_time }}"></span>
                            </span>
                        {% endif %}

                        <div class="topic_title_wrapper">
                            <a class="topic_title" href="{{ url_for('topic.detail', id=t.id) }}">
                                {{ t.title }}
                            </a>
                        </div>
                    </div>
                    {#            <div class="cell more">#}
                    {#                <a class="dark" href="/user/justjavac/replies">查看更多»</a>#}
                    {#            </div>#}
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}